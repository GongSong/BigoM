<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Bigo M</title>

		<meta name="description" content="Minimal empty page" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!--basic styles-->

		<link href="/static/assets/css/bootstrap.min.css" rel="stylesheet" />
		<link href="/static/assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="/static/assets/css/font-awesome.min.css" rel="stylesheet" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="/static/assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!--page specific plugin styles-->
        <link rel="stylesheet" href="/static/assets/css/jquery-ui-1.10.3.full.min.css" />

		<!--fonts-->

		<link rel="stylesheet" href="/static/assets/css/ace-fonts.css" />

		<!--ace styles-->

		<link rel="stylesheet" href="/static/assets/css/ace.min.css" />
		<link rel="stylesheet" href="/static/assets/css/ace-responsive.min.css" />
		<link rel="stylesheet" href="/static/assets/css/ace-skins.min.css" />

		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="/static/assets/css/ace-ie.min.css" />
		<![endif]-->

		<!--inline styles related to this page-->

		<!--ace settings handler-->

		<script src="/static/assets/js/ace-extra.min.js"></script>
        <script type="text/javascript">
            function operationhistory(url, log_id, event_id, ul_id) {
                $(ul_id).empty();
                var pdata = { 'log_id':log_id, 'event_id':event_id };
                $.getJSON(url, pdata, function(data) {
                    if (data.result != null && data.result == 'ok') {
                        var history = data.history;
                        for (var i=0; i<history.length; i++) {
                            var li =
                            "<li class='item-blue '>" +
                            "    <div class='time span4'>" +
                            "        <i class=’icon-time'></i>" +
                            "        <span class='green'>" + history[i].date_time + "</span>" +
                            "    </div>" +
                            "    <div class='name span8'>" +
                            "        <span>" + history[i].status + "</span>" +
                            "    </div>" +
                            "    <div class='text'>" + history[i].comment + "</div>" +
                            "</li>";
                            $(ul_id).append(li);
                        }
                    }
                    var dialog = $( "#dialog-operationhistory" ).dialog({
                        modal: true,
                        width: '35%',
                        height: '360',
                        title: "<div class='widget-header widget-header-small'><h4 class='smaller'><i class='icon-ok'></i> 处理履历 </h4></div>",
                        title_html: true
                    });
                });
            }
            function operationdetail(url, sysinfo_id, log_id, ul_id) {
                var pdata = { 'sysinfo_id':sysinfo_id};
                $.getJSON(url, pdata, function(data) {
                    var sysinfo = data.sysinfo
                    if (sysinfo != null) {
                        $(ul_id).empty();
                        for (var i=0; i<sysinfo.length; i++) {
                            var info = sysinfo[i].info;

                            var status= sysinfo[i].status;
                            var css='';
                            if (status == 'error') {
                                css += 'badge badge-important ';
                            } else if (status == 'warning') {
                                css += 'badge badge-warning ';
                            } else if (status == 'ok') {
                                css += 'badge badge-success ';
                            }
                            var icon = "        <span class='" + css + "'> &nbsp;</span><br>";

                            var span = '';
                            for (var j=0; j<info.length; j++) {
                                var ii = info[j].info;
                                for (var k=0; k<ii.split(',').length; k++) {
                                    span += ii.split(',')[k] + '<br>'
                                }
{#                                var status= info[j].status;#}
{#                                var css='badge ';#}
{#                                if (status == 'error') {#}
{#                                    css += 'badge-important ';#}
{#                                } else if (status == 'warning') {#}
{#                                    css += 'badge-warning ';#}
{#                                } else {#}
{#                                    css += 'badge-success ';#}
{#                                }#}
{#                                span += "        <span class='" + css + "'>" + ii + "</span><br>";#}

                            }
                            var li =
                            "<li class='item-blue '>" +
                            "    <label class='span2 inline'> <span class='span8'>" + sysinfo[i].item + '</span>' +  icon + "</label>" +
                            "    <label class='inline'>" + span +
                            "    </label>" +
                            "</li>";
                            $(ul_id).append(li);
                        }

                    }
                    var dialog = $( "#dialog-operationdetail" ).dialog({
                        modal: true,
                        width: '70%',
                        height: '600',
                        title: "<div class='widget-header widget-header-small'><h4 class='smaller'><i class='icon-ok'></i> 处理详细 </h4></div>",
                        title_html: true,
                        buttons: [
                            {
                                text: "取消",
                                "class" : "btn btn-mini",
                                click: function() {
                                    $( this ).dialog( "close" );
                                }
                            },
                            {
                                text: "确定",
                                "class" : "btn btn-primary btn-mini",
                                click: function() {
                                    var status = $("input[name='form-field-status']:checked").val();
                                    var comment = $('#form-field-comment').val();
                                    if (status == undefined) {
                                        alert('请选择处理方式');
                                        return false;
                                    } else if (status == 'fix') {
                                    } else if (status == 'error') {
                                        if (comment=='') {
                                            alert('请输入注释');
                                            return false;
                                        }
                                    } else if (status == 'ignor') {
                                        if (comment=='') {
                                            alert('请输入注释');
                                            return false;
                                        }
                                    }

                                    var pdata = { 'status':status, 'comment':comment, 'log_id':log_id};
                                    var _self = this;
                                    $.getJSON(url, pdata, function(data) {
                                        if (data.result == 'ok') {
                                            location.reload();
                                        } else {
                                            return false;
                                        }
                                    });
                                }
                            }
                        ]
                    });
                });
            }
        </script>
	</head>

	<body>
		<div class="navbar" id="navbar">
			<div class="navbar-inner">
				<div class="container-fluid">
					<a href="#" class="brand">
						<small>
							<i class="icon-leaf"></i>
							Bigo M
						</small>
					</a><!--/.brand-->
				</div><!--/.container-fluid-->
			</div><!--/.navbar-inner-->
		</div>

		<div class="main-container container-fluid">
			<a class="menu-toggler" id="menu-toggler" href="#">
				<span class="menu-text"></span>
			</a>

			<div class="sidebar" id="sidebar">
				<ul class="nav nav-list">
					<li>
						<a href="index">
							<i class="icon-dashboard"></i>
							<span class="menu-text"> Dashboard </span>
						</a>
					</li>

					<li>
						<a href="hostlist">
							<i class="icon-desktop"></i>
							<span class="menu-text"> Hosts </span>
						</a>
					</li>
				</ul><!--/.nav-list-->

				<div class="sidebar-collapse" id="sidebar-collapse">
					<i class="icon-double-angle-left" data-icon1="icon-double-angle-left" data-icon2="icon-double-angle-right"></i>
				</div>
			</div>

			<div class="main-content">
				<div class="page-content ">
					<div class="row-fluid">
						<div class="span12">
                            {% if EventLogs is none %}
							<h3 class="header smaller lighter blue">{{ HostName }} &nbsp;
								<a href="{{ url_for('host.hostdetail', host=Host) }}" data-action="reload"><i class="icon-refresh"></i></a>
							</h3>
							<div class="row-fluid">
								<div class="span6">
									<table id="sample-table-1" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th class="span1">系统</th>
												<th class="span2">状态</th>
                                                <th class="span2 align-right">{{ SysDateTime }}</th>
											</tr>
										</thead>

										<tbody>
                                            {% for SysInfo in SysInfoList %}
                                            <tr>
												<td>
													<a href="#" class="span9">{{ SysInfo.item }}</a>
                                                    {% if SysInfo.status == 'error' %}
                                                        <span class="badge badge-important "> &nbsp;</span>
                                                    {% elif SysInfo.status == 'warning' %}
                                                        <span class="badge badge-warning "> &nbsp;</span>
                                                    {% elif SysInfo.status == 'ok' %}
                                                        <span class="badge badge-success "> &nbsp;</span>
                                                    {% endif %}
												</td>
												<td colspan="2">
                                                    {% for info in SysInfo.info %}
                                                        {% for ii in info.info.split(',') %}
                                                            {{ ii }}<br>
                                                        {% endfor %}
{#                                                        {% if info.status.startswith('error') %}#}
{#                                                            <span class="badge badge-important ">#}
{#                                                                {% for ii in info.info.split(',') %}#}
{#                                                                    {{ ii }}<br>#}
{#                                                                {% endfor %}#}
{#                                                            </span><br>#}
{#                                                        {% elif info.status.startswith('warning') %}#}
{#                                                            <span class="badge badge-warning ">#}
{#                                                                {% for ii in info.info.split(',') %}#}
{#                                                                    {{ ii }}<br>#}
{#                                                                {% endfor %}#}
{#                                                            </span><br>#}
{#                                                        {% else %}#}
{#                                                            <span class="badge badge-success ">#}
{#                                                                {% for ii in info.info.split(',') %}#}
{#                                                                    {{ ii }}<br>#}
{#                                                                {% endfor %}#}
{#                                                            </span><br>#}
{#                                                        {% endif %}#}
                                                    {% endfor %}
												</td>
                                            </tr>
                                            {% endfor %}
										</tbody>
									</table>
								</div><!--/span-->
								<div class="span6">
									<table id="sample-table-1" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th class="span1">业务</th>
												<th class="span2">处理结果</th>
												<th class="span2">最终更新时间</th>
											</tr>
										</thead>

										<tbody>
                                            {% for Event in EventList %}
                                            <tr>
                                                <td>
                                                    <a class="span9" href="{{ url_for('host.hostdetail', host=Host, event=Event.event) }}">{{ Event.name }}</a>
                                                </td>
												<td>
													<span class="badge badge-success ">{{ Event.ok_cnt }}</span>
													<span class="badge badge-warning ">{{ Event.warning_cnt }}</span>
													<span class="badge badge-important ">{{ Event.error_cnt }}</span>
                                                    <span class="badge badge-grey ">{{ Event.unknown_cnt }}</span>
												</td>
                                                <td>{{ Event.date_time }}</td>
                                            </tr>
                                            {% endfor %}
										</tbody>
									</table>
								</div><!--/span-->
							</div><!--/row-->
                            {% endif %}
                            {% if not EventLogs is none %}
							<div class="row-fluid">
								<div class="span12">
									<h3 class="header smaller lighter blue">{{ HostName }} &nbsp;<a href="{{ url_for('host.hostdetail', host=Host) }}"><i class="icon-reply"></i></a>  &nbsp; {{ EventName }} </h3>
									<table id="sample-table-2" class="table table-striped table-bordered table-hover" >
										<thead>
											<tr>
                                                <th class="span1">ID</th>
												<th class="span1">状态</th>
												<th class="span2">发生时间</th>
												<th class="span2">最终结果</th>
                                                <th class="span2">最终时间</th>
                                                <th class="span2">操作</th>
											</tr>
										</thead>

										<tbody>
                                            {% for EventLog in EventLogs %}
                                            <tr>
                                                <td>{{ EventLog.event_id }}</td>
                                                <td>{{ EventLog.status }}</td>
                                                <td>{{ EventLog.event_datetime }}</td>
                                                <td><a class="badge {% if EventLog.operation.startswith('error') %}badge-important {% elif EventLog.operation.startswith('warning') %}badge-warning {% elif EventLog.operation.startswith('ok') or EventLog.operation.startswith('fix') or EventLog.operation.startswith('ignor') %}badge-success {% else %}badge-grey {% endif %}"
                                                     onclick="javascript:operationhistory('{{ url_for('host.operationhistory') }}', '{{ EventLog.id }}', '{{ EventLog.event_id }}', '#id-history-ul')"> &nbsp;</a> {{ EventLog.operation }} </td>
                                                <td>{{ EventLog.operation_datetime }}</td>
                                                <td>
                                                    <button class="btn btn-minier" id="bootbox-regular" onclick="operationdetail('{{ url_for('host.operationdetail') }}', '{{ EventLog.sysinfo_id }}', '{{ EventLog.id }}', '#id-detail-ul')">处理详细</button>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            <div id="dialog-operationhistory" class="hide">
                                                <div class="row-fluid">
                                                    <div class="span12">
                                                        <ul class="item-list" id="id-history-ul">
                                                        </ul>
                                                    </div><!--/span-->
                                                </div>
                                            </div><!--#dialog-message-->
                                            <div id="dialog-operationdetail" class="hide">
                                                <div class="row-fluid">
                                                    <div class="span6">
                                                        <h4 class="smaller lighter blue">
															<i class="icon-list"></i>
															系统情报
														</h4>

														<ul class="item-list" id="id-detail-ul">
															<li class="item-blue ">
                                                                <label class="span2 inline"> CPU</label>
																<label class="inline">
																	<span></span>
																</label>
															</li>

															<li class="item-blue ">
                                                                <label class="span2 inline"> 内存</label>
																<label class="inline">
                                                                    <span></span>
																</label>
															</li>

															<li class="item-blue ">
                                                                <label class="span2 inline"> 磁盘</label>
																<label class="inline">
                                                                    <span></span>
																</label>
															</li>

															<li class="item-blue ">
                                                                <label class="span2 inline"> 服务</label>
																<label class="inline">
                                                                    <span></span>
																</label>
															</li>

															<li class="item-blue ">
                                                                <label class="span2 inline"> 数据库</label>
																<label class="inline">
                                                                    <span></span>
																</label>
															</li>
														</ul>
                                                    </div><!--/span-->
                                                    <div class="span6">
                                                        <h4 class="smaller lighter blue">
															<i class="icon-list"></i>
															处理方式
														</h4>

                                                        <ul class="item-list">
															<li class="item-blue ">
                                                                <label class="inline span2">
                                                                    <input name="form-field-status" type="radio" class="ace" value="error" />
                                                                    <span class="lbl">错误</span>
                                                                </label>
                                                                <label class="inline span2">
                                                                    <input name="form-field-status" type="radio" class="ace" value="ignor" />
                                                                    <span class="lbl">忽略</span>
                                                                </label>
                                                                <label class="inline span2">
                                                                    <input name="form-field-status" type="radio" class="ace" value="fix" />
                                                                    <span class="lbl">修复</span>
                                                                </label>

                                                                <textarea class="span12" id="form-field-comment" placeholder="Comment" style="height: 143px;"></textarea>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div><!--#dialog-message-->
										</tbody>
									</table>
								</div>
							</div>
                            {% endif %}
						</div><!--/.span-->
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->
				<div class="ace-settings-container hide" id="ace-settings-container">
					<div class="btn btn-app btn-mini btn-warning ace-settings-btn" id="ace-settings-btn">
						<i class="icon-cog bigger-150"></i>
					</div>

					<div class="ace-settings-box" id="ace-settings-box">
						<div>
							<div class="pull-left">
								<select id="skin-colorpicker" class="hide">
									<option data-skin="default" value="#438EB9">#438EB9</option>
									<option data-skin="skin-1" value="#222A2D">#222A2D</option>
									<option data-skin="skin-2" value="#C6487E">#C6487E</option>
									<option data-skin="skin-3" value="#D0D0D0">#D0D0D0</option>
								</select>
							</div>
							<span>&nbsp; Choose Skin</span>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-navbar" />
							<label class="lbl" for="ace-settings-navbar"> Fixed Navbar</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-sidebar" />
							<label class="lbl" for="ace-settings-sidebar"> Fixed Sidebar</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-breadcrumbs" />
							<label class="lbl" for="ace-settings-breadcrumbs"> Fixed Breadcrumbs</label>
						</div>

						<div>
							<input type="checkbox" class="ace ace-checkbox-2" id="ace-settings-rtl" />
							<label class="lbl" for="ace-settings-rtl"> Right To Left (rtl)</label>
						</div>
					</div>
				</div><!--/#ace-settings-container-->
			</div><!--/.main-content-->
		</div><!--/.main-container-->

		<!--basic scripts-->

		<!--[if !IE]>-->

		<script type="text/javascript">
			window.jQuery || document.write("<script src='/static/assets/js/jquery-2.0.3.min.js'>"+"<"+"/script>");
		</script>

		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='/static/assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='/static/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="/static/assets/js/bootstrap.min.js"></script>

		<!--page specific plugin scripts-->
		<script src="/static/assets/js/jquery.dataTables.min.js"></script>
		<script src="/static/assets/js/jquery.dataTables.bootstrap.js"></script>
		<script src="/static/assets/js/jquery-ui-1.10.3.full.min.js"></script>
		<script src="/static/assets/js/jquery.ui.touch-punch.min.js"></script>
        <script src="/static/assets/js/bootbox.min.js"></script>
		<!--ace scripts-->

		<script src="/static/assets/js/ace-elements.min.js"></script>
        <script src="/static/assets/js/ace.min.js"></script>

		<script type="text/javascript">
			jQuery(function($) {
				var oTable1 = $('#sample-table-2').dataTable( {
                "aaSorting": [],
				"aoColumns": [
                  { "bSortable": false },
                    null,
			      { "bSortable": false },
                    null,
				  { "bSortable": false },
				  { "bSortable": false }
				] } );
				//override dialog's title function to allow for HTML titles
				$.widget("ui.dialog", $.extend({}, $.ui.dialog.prototype, {
					_title: function(title) {
						var $title = this.options.title || '&nbsp;'
						if( ("title_html" in this.options) && this.options.title_html == true )
							title.html($title);
						else title.text($title);
					}
				}));
			})
		</script>
		<!--inline scripts related to this page-->
	</body>
</html>
